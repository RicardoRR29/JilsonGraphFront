<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app">
      <div id="main"></div>
      <div class="buttons">
        <button
          type="button"
          @click="() => {
            openModalNode = !openModalNode
            if(openModalNode) {
              openModalRelation = false;
              openModalEdge = false;
            }
          }"
          class="btn-f btn-create-node"
        >
          + NÓ
        </button>
        <button
          type="button"
          @click="() => {
            openModalEdge = !openModalEdge
            if(openModalEdge) {
              openModalRelation = false;
              openModalNode = false;
            }
          }"
          class="btn-f btn-create-node"
        >
          + Aresta
        </button>

        <button
          type="button"
          class="btn-f btn-create-edge"
          @click="() => {
            openModalRelation = !openModalRelation
            if(openModalRelation) {
              openModalNode = false;
              openModalEdge = false;
            }
          }"
        >
          + Relação
        </button>
        <transition name="fade">
          <modal class="modal" v-show="openModalNode">
            <div class="modal-title"></div>
            <label for="nomeNode">
              Nome do Nó
              <input type="text" v-model="nodeName" />
            </label>
            <div class="property" v-for="(property) in nodeProperties">
              <label for="duration">Nome da propriedade:</label>
              <input type="text" v-model="property.fieldName" required>
              <label for="duration">Valor da propriedade:</label>
              <input type="text" v-model="property.fieldValue" required>
            </div>
            <div class="btn-style">
              <button @click="addNodeProperty">Adicionar propriedade</button>
              <button @click="removeNodeProperty">Remover propriedade</button>
              <button @click="sendNode">Enviar</button>
            </div>
          </modal>
        </transition>
        <transition name="fade">
          <modal class="modal" v-show="openModalRelation">
            <div class="modal-title"></div>
            <label for="relation-name">
              Nome da Relação:
              <input v-model="relationName" type="text" id="relation-name" class="relation-name" name="relation-name" />
            </label>
            <label for="first-node-name">
              Nome do primeiro nó:
              <input v-model="firstNodeName" type="text" id="first-node-name" class="first-node-name" name="first-node-name" />
            </label>
            <label for="second-node-name">
              Nome do segundo nó:
              <input v-model="secondNodeName" type="text" id="second-node-name" class="second-node-name" name="second-node-name" />
            </label>
            <!-- <div class="property" v-for="(property) in edgeProperties">
              <label for="duration">Nome da propriedade:</label>
              <input type="text" v-model="property.fieldName" required>
              <label for="duration">Valor da propriedade:</label>
              <input type="text" v-model="property.fieldValue" required>
            </div> -->
            <div class="btn-style">
              <!-- <button @click="addEdgeProperty">Adicionar propriedade</button>
              <button @click="removeEdgeProperty">Remover propriedade</button> -->
              <button @click="sendEdge">Enviar</button>
            </div>
          </modal>
        </transition>
        <transition name="fade">
          <modal class="modal" v-show="openModalEdge">
            <div class="modal-title"></div>
            <label for="relation-name">
              Nome da Relação:
              <input v-model="edgeName" type="text" id="relation-name" class="relation-name" name="relation-name" />
            </label>
            <label for="first-node-name">
              Id do primeiro nó:
              <input v-model="firstNodeId" type="text" id="first-node-name" class="first-node-name" name="first-node-name" />
            </label>
            <label for="second-node-name">
              Id do segundo nó:
              <input v-model="secondNodeId" type="text" id="second-node-name" class="second-node-name" name="second-node-name" />
            </label>
            <div class="property" v-for="(property) in edgeProperties">
              <label for="duration">Nome da propriedade:</label>
              <input type="text" v-model="property.fieldName" required>
              <label for="duration">Valor da propriedade:</label>
              <input type="text" v-model="property.fieldValue" required>
            </div>
            <div class="btn-style">
              <button @click="addEdgeProperty">Adicionar propriedade</button>
              <button @click="removeEdgeProperty">Remover propriedade</button>
              <button @click="sendEdge">Enviar</button>
            </div>
          </modal>
        </transition>
      </div>
    </div>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-vue/2.22.0/bootstrap-vue.min.js"
      integrity="sha512-fpl6VxrVL83pzi0dMBPknsykT+mf3+TLzBigOtNKp1cPi2oEpooeOzTb+tOku1YhL7/0eDfe9nnzCPzuAwvtog=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.3.3/echarts.min.js"
      integrity="sha512-2L0h0GhoIHQEjti/1KwfjcbyaTHy+hPPhE1o5wTCmviYcPO/TD9oZvUxFQtWvBkCSTIpt+fjsx1CCx6ekb51gw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script>
      const api = axios.create({
        baseURL: "https://jilsongraph.herokuapp.com/",
      });
      new Vue({
        el: "#app",
        data: {
          openModalNode: false,
          openModalRelation: false,
          openModalEdge: false,

          // Nó
          nodeName: '',
          nodeProperties: [{
            fieldName: '',
            fieldValue: '',
          }],

          // Aresta
          relationName: '',
          firstNodeName: '',
          secondNodeName: '',
          directed: false,

          edgeName: '',
          firstNodeId: '',
          secondNodeId: '',
          edgeProperties: [{
            fieldName: '',
            fieldValue: '',
          }],
        },
        methods: {
          createEdge(nome) {
            api.get("/doc", {
              name: nome,
              type: "edge",
            });
          },
          createNode(nome) {
            api.get("/doc", {
              name: nome,
              type: "node",
            });
          },
          postObjInNode(nodeName, properties) {
            api.post("/node", {
              nodeName,
              properties: properties,
            });
          },

          postEdge({ relationName, firstNodeName, secondNodeName }) {
            api.post(`/edge/${relationName}`, {
              firstNodeName,
              secondNodeName,
              directed: true,
            });
          },
          getNodeInfos(nodeName) {
            api.get("/node/all/Pessoa");
          },

          addNodeProperty() {
            this.nodeProperties.push({
              fieldName: '',
              fieldValue: '',
            });
          },

          removeNodeProperty() {
            if (this.nodeProperties.length - 1 > 0) {
              this.nodeProperties.splice(this.nodeProperties.length - 1,1);
            }
          },

          sendNode() {
            console.log(this.nodeName);
            for (const property of this.nodeProperties) {
              console.log(property);
            }
          },

          addEdgeProperty() {
            this.edgeProperties.push({
              fieldName: '',
              fieldValue: '',
            });
          },

          removeEdgeProperty() {
            if (this.edgeProperties.length - 1 > 0) {
              this.edgeProperties.splice(this.edgeProperties.length - 1,1);
            }
          },

          sendRelation() {
            postEdge({ relationName: this.relationName, firstNodeName: this.firstNodeName, secondNodeName: this.secondNodeName });
          },
        },

        mounted() {
          api.get("node/all/Pessoa");

          var chartDom = document.getElementById("main");
          var myChart = echarts.init(chartDom, "dark");
          var option;
          option = {
            title: {
              text: "Basic Graph",
            },
            tooltip: {},
            animationDurationUpdate: 1500,
            animationEasingUpdate: "quinticInOut",
            series: [
              {
                type: "graph",
                layout: "none",
                symbolSize: 50,
                roam: true,
                label: {
                  show: true,
                },
                edgeSymbol: ["circle", "arrow"],
                edgeSymbolSize: [4, 10],
                edgeLabel: {
                  fontSize: 20,
                },
                data: [
                  {
                    name: "Node 1",
                    x: 300,
                    y: 300,
                  },
                  {
                    name: "Node 2",
                    x: 800,
                    y: 300,
                  },
                  {
                    name: "Node 3",
                    x: 550,
                    y: 100,
                  },
                  {
                    name: "Node 4",
                    x: 550,
                    y: 500,
                  },
                ],
                // links: [],
                links: [
                  {
                    source: 0,
                    target: 1,
                    symbolSize: [5, 20],
                    label: {
                      show: true,
                    },
                    lineStyle: {
                      width: 5,
                      curveness: 0.2,
                    },
                  },
                  {
                    source: "Node 2",
                    target: "Node 1",
                    label: {
                      show: true,
                    },
                    lineStyle: {
                      curveness: 0.2,
                    },
                  },
                  {
                    source: "Node 1",
                    target: "Node 3",
                  },
                  {
                    source: "Node 2",
                    target: "Node 3",
                  },
                  {
                    source: "Node 2",
                    target: "Node 4",
                  },
                  {
                    source: "Node 1",
                    target: "Node 4",
                  },
                ],
                lineStyle: {
                  opacity: 0.9,
                  width: 2,
                  curveness: 0,
                },
              },
            ],
          };

          option && myChart.setOption(option);
        },
      });
    </script>
  </body>
</html>
